<link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/plug-ins/3cfcc339e89/integration/bootstrap/3/dataTables.bootstrap.css">

<p id="notice"><%= notice %></p>
<%= will_paginate @friendsActivity %>
<h1>Home</h1>
<div class="row" style="margin-left: 50px;">
    <div class="col-sm-6">
        <table id="example" class="table display" style="width:80%">
            <thead>
                <tr>
                    <th colspan="2">Friends Activity</th>
                </tr>
            </thead>
            <tbody>
                <% @friendsActivity.each do |friend| %>
                <tr>
                    <td><%= friend.meal %></td>
                    <td><%= friend.id %></td>
                    <td><%= friend.model.username %></td>

                    <td></td>

                </tr>
                <% end %>
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="2"></th>
                </tr>
            </tfoot>
        </table>
    </div>
    <div class="col-sm-6">
        <table id="example" class="table display" style="width:80%">
            <thead>
                <tr>
                    <th colspan="2">Leatest Activity</th>
                </tr>
            </thead>
            <tbody>
                <% @userLatestActivity.each do |order| %>
                <tr>
                    <td><%= order.meal %></td>

                    <td></td>


                </tr>
                <% end %>

            </tbody>
            <tfoot>
                <tr>
                    <th colspan="2"></th>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
<br>
<style>
    .table-fixed thead {
        width: 97%;
    }

    .table-fixed tbody {
        height: 230px;
        overflow-y: auto;
        width: 100%;
    }

    .table-fixed thead,
    .table-fixed tbody,
    .table-fixed tr,
    .table-fixed td,
    .table-fixed th {
        display: block;
    }

    .table-fixed tbody td,
    .table-fixed thead>tr>th {
        float: left;
        border-bottom-width: 0;
    }
</style>
<script>
    $(document).ready(function() {
        $('#example').DataTable();
    });
</script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#suggestion_form').keyup(function() {
            $form = $(this)
            var formData = new FormData(this);
            var username = document.getElementById('suggestion').value
            var query = $(this).val();
            $.ajax({
                url: "/search",
                type: 'GET',
                data: {
                    username: username
                },

                success: function(data) {
                    console.log(JSON.parse(data["message"]));
                    data["message"] = JSON.parse(data["message"])
                    $("#searchbox").css("display", "block");
                    $("#searchbox").empty()
                    for (i in data["message"]) {
                        $('#searchbox').append('<li class="list-group-item" ><div style="float:left">' + data[
                            "message"][i].username + '</div><div style="float:right"> <input id="' + data["message"][i].id + '" type="checkbox"></div><br></li>');
                        $('#' + i + '').click();
                    }
                },
                failure: function(data) {
                    console.log("FAIL");
                    console.log(data);
                }
            });
        });
    });

    function notify(e) {
        event.preventDefault();
        $("#searchbox").css("display", "none");
        var els = document.querySelectorAll('.chks input[type="checkbox"]:checked');
        for (var i = 0; i < els.length; i++) {
            var id = els[i].id;
            console.log(id)

            $.ajax({
                async: false,
                cache: false,
                url: "/addrequest",
                type: 'GET',
                data: {
                    uniq_param: (new Date()).getTime(),
                    id: id
                },
                success: function(data) {
                    console.log("sent to ", id);

                },
                failure: function(data) {
                    console.log("FAIL");
                    console.log(data);
                }
            });

        }
    }
    $(document).click(function() {
        $("#searchbox").css("display", "none");

    });
    $("#searchbox").click(function(e) {
        e.stopPropagation();
    })
</script>